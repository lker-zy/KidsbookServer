<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>图书系列 - 最美童书 - 后台管理</title>

    <!-- Bootstrap -->
    <link href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="http://v3.bootcss.com/examples/dashboard/dashboard.css" rel="stylesheet">

    <!-- Generic page styles -->
    <link rel="stylesheet" href="webres/fileupload/css/style.css">
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href="webres/fileupload/css/jquery.fileupload.css">

    <link rel="stylesheet" href="webres/css/kidsbook.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>

    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" href="webres/wysiwyg/css/style.css">
</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">最美童书馆 - 管理后台</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">Settings</a></li>
                <li><a href="#">Profile</a></li>
                <li><a href="#">Help</a></li>
            </ul>
            <form class="navbar-form navbar-right">
                <input type="text" class="form-control" placeholder="Search...">
            </form>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar" id="bookMenu">
                <li><a href="list.html">平台书库</a></li>
                <li><a href="add.html">图书添加</a></li>
                <li class="active"><a href="#">图书系列 <span class="sr-only">(current)</span></a></li>
            </ul>
            <ul class="nav nav-sidebar">
                <li><a href="">用户统计</a></li>
                <li><a href="">用户管理</a></li>
            </ul>
            <ul class="nav nav-sidebar">
                <li><a href="activity.html">活动配置</a></li>
                <li><a href="crowd.html">新书试读</a></li>
                <li><a href="">合作方管理</a></li>
            </ul>
        </div>


        <!-- Main Content Area -->
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <ol class="breadcrumb">
                <li><a href="#">Home</a></li>
                <li><a href="#">图书</a></li>
                <li class="active">图书系列</li>
            </ol>

            <div class="alert alert-success">
                <button type="button" class="close" data-dismiss="alert">×</button>
                <strong>注意!</strong> 当前是在测试环境.
            </div>

            <hr>

            <div class="alert alert-failed">
                图书系列维护， 敬请期待......
            </div>

        </div>
    </div>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>

<script src="http://cdn.bootcss.com/blueimp-file-upload/9.10.4/vendor/jquery.ui.widget.js"></script>
<script src="http://cdn.bootcss.com/blueimp-file-upload/9.10.4/jquery.fileupload.js"></script>
<script src="http://cdn.bootcss.com/blueimp-file-upload/9.10.4/jquery.iframe-transport.js"></script>

<!-- The Load Image plugin is included for the preview images and image resizing functionality -->
<script src="http://blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js"></script>
<!-- The Canvas to Blob plugin is included for image resizing functionality -->
<script src="http://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
<!-- The File Upload processing plugin -->
<script src="webres/fileupload/js/jquery.fileupload-process.js"></script>
<!-- The File Upload image preview & resize plugin -->
<script src="webres/fileupload/js/jquery.fileupload-image.js"></script>
<!-- The File Upload audio preview plugin -->
<script src="webres/fileupload/js/jquery.fileupload-audio.js"></script>
<!-- The File Upload video preview plugin -->
<script src="webres/fileupload/js/jquery.fileupload-video.js"></script>
<!-- The File Upload validation plugin -->
<script src="webres/fileupload/js/jquery.fileupload-validate.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="webres/css/bootstrap-table.css">

<!-- Latest compiled and minified JavaScript -->
<script src="webres/js/bootstrap-table.js"></script>

<!-- Latest compiled and minified Locales -->
<!--
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/locale/bootstrap-table-zh-CN.min.js"></script>
-->

<script>
    /*jslint unparam: true, regexp: true */
    /*global window, $ */
    $(function () {
        'use strict';
        var url = "http://localhost:8080/imageupload";
        var uploadButton = $('<button/>')
                .addClass('btn btn-primary')
                .prop('disabled', true)
                .text('Processing...')
                .on('click', function () {
                    var $this = $(this),
                            data = $this.data();
                    $this
                            .off('click')
                            .text('Abort')
                            .on('click', function () {
                                $this.remove();
                                data.abort();
                            });
                    data.submit().always(function () {
                        $this.remove();
                    });
                });
        $('#fileupload').fileupload({
            url: url,
            dataType: 'json',
            autoUpload: false,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 99900000,
            // Enable image resizing, except for Android and Opera,
            // which actually support image resizing, but fail to
            // send Blob objects via XHR requests:
            disableImageResize: /Android(?!.*Chrome)|Opera/
                    .test(window.navigator.userAgent),
            previewMaxWidth: 100,
            previewMaxHeight: 100,
            previewCrop: true
        }).on('fileuploadadd', function (e, data) {
            data.context = $('<div/>').appendTo('#files');
            $.each(data.files, function (index, file) {
                var node = $('<p/>')
                        .append($('<span/>').text(file.name));
                if (!index) {
                    node.append('<br>')
                            .append(uploadButton.clone(true).data(data));
                }
                node.appendTo(data.context);
            });
        }).on('fileuploadprocessalways', function (e, data) {
            var index = data.index,
                    file = data.files[index],
                    node = $(data.context.children()[index]);
            if (file.preview) {
                node.prepend('<br>')
                        .prepend(file.preview);
            }
            if (file.error) {
                node.append('<br>')
                        .append($('<span class="text-danger"/>').text(file.error));
            }
            if (index + 1 === data.files.length) {
                data.context.find('button')
                        .text('Upload')
                        .prop('disabled', !!data.files.error);
            }
        }).on('fileuploadprogressall', function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css(
                    'width',
                    progress + '%'
            );
            $('#progress .progress-bar').html(
                    progress + '%'
            );
        }).on('fileuploaddone', function (e, data) {
            $.each(data.result.files, function (index, file) {
                if (file.url) {
                    var link = $('<a>')
                            .attr('target', '_blank')
                            .prop('href', file.url);
                    $(data.context.children()[index])
                            .wrap(link);
                } else if (file.error) {
                    var error = $('<span class="text-danger"/>').text(file.error);
                    $(data.context.children()[index])
                            .append('<br>')
                            .append(error);
                }
            });
        }).on('fileuploadfail', function (e, data) {
            $.each(data.files, function (index) {
                var error = $('<span class="text-danger"/>').text('File upload failed.');
                $(data.context.children()[index])
                        .append('<br>')
                        .append(error);
            });
        }).prop('disabled', !$.support.fileInput)
                .parent().addClass($.support.fileInput ? undefined : 'disabled');
    });

    $('#baseConfirm').on('click', function () {
        var multi = ['category', 'genre', 'age_radio'];
        var str_data = $("#base-form input").map(function() {
            var form_name = $(this).attr("name");
            if (jQuery.inArray(form_name, multi) >= 0) {
                return null;
            }
            return ($(this).attr("name")+'='+$(this).val());
        }).get().join("&");

        var category = $("input[name='category']:checked").map(function() {
            return $(this).val();
        }).get().join(":");
        category = "category=" + category;

        var genre = $("input[name='genre']:checked").map(function() {
            return $(this).val();
        }).get().join(":");
        genre = "genre=" + genre;

        var age = $("input:radio[name='age_radio']:checked").val();
        if (age == null) {
            alert("radio null");
            age = "";
        } else {
            age = "age=" + age;
        }

        str_data = str_data + "&" + category + "&" + genre + "&" + age;
        $.ajax({
            type: "POST",
            url: "add.action",
            data: str_data,
            dataType: "json",
            success: function(msg){
                if (msg.errno == 0) {
                    alert("submit successfully");
                    $('#addBookTabs a[href="#profile"]').tab('show');
                } else {
                    alert("submit to server failed");
                }
            },
            error: function() {
                alert("服务器异常");
            }
        });

    })
    $('#profileConfirm').on('click', function () {
        $('#addBookTabs a[href="#publish"]').tab('show');
    })
    $('#publishConfirm').on('click', function () {
        $('#addBookTabs a[href="#recommend"]').tab('show');
    })
    $('#recConfirm').on('click', function () {
        alert("已经提交到服务器进行添加");
    })
</script>

</body>
</html>
